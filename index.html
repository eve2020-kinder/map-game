<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Evelynâ€™s Reading Adventure â€” Kinder MAP Practice</title>
  <style>
    :root { --bg:#f6f7fb; --card:#fff; --text:#1f2937; --muted:#6b7280; --primary:#2563eb; --correct:#16a34a; --wrong:#dc2626; --shadow:0 10px 24px rgba(0,0,0,.08); --radius:18px; }
    *{box-sizing:border-box} body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;line-height:1.5}
    .wrap{max-width:960px;margin:32px auto;padding:16px}
    header{display:flex;align-items:center;gap:16px;margin-bottom:16px}
    .title{font-size:1.6rem;font-weight:800;letter-spacing:.2px}
    .subtitle{color:var(--muted);font-size:.95rem}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px}
    .progress{width:100%;height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden;margin:8px 0 16px}
    .progress__bar{height:10px;width:0;background:var(--primary);transition:width .3s ease}
    .settings{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:8px 0 14px}
    .settings label{font-size:.95rem;color:var(--muted)}
    select, .tog{appearance:none;border:2px solid #e5e7eb;border-radius:10px;padding:8px 10px;background:#fff}
    .question{display:grid;grid-template-columns:1fr;gap:12px;margin:6px 0 12px}
    .emoji{font-size:64px;line-height:1;display:inline-block;filter:drop-shadow(0 4px 10px rgba(0,0,0,.1));cursor:pointer}
    .passage{font-size:1.15rem;background:#f9fafb;border-radius:12px;padding:14px;cursor:pointer}
    .qtext{font-size:1.25rem;font-weight:700;margin-top:4px;cursor:pointer}
    .choices{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;margin-top:8px}
    button.choice{border:2px solid #e5e7eb;background:#fff;padding:14px 16px;border-radius:12px;font-size:1.05rem;text-align:left;cursor:pointer;transition:transform .05s,border-color .2s,box-shadow .2s,background .2s}
    button.choice:hover{transform:translateY(-1px)} button.choice:focus{outline:3px solid rgba(37,99,235,.35)}
    button.choice.correct{background:rgba(22,163,74,.08);border-color:rgba(22,163,74,.6)}
    button.choice.wrong{background:rgba(220,38,38,.08);border-color:rgba(220,38,38,.6)}
    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px}
    .btn{border:0;padding:12px 16px;border-radius:12px;font-weight:700;cursor:pointer;box-shadow:var(--shadow);background:var(--primary);color:#fff;transition:transform .06s,opacity .2s,background .2s}
    .btn:disabled{opacity:.5;cursor:not-allowed} .btn.light{background:#111827} .btn.ghost{background:#fff;color:var(--text);border:2px solid #e5e7eb;box-shadow:none}
    .score{margin-left:auto;font-weight:800}
    .feedback{min-height:28px;margin-top:6px;font-weight:600} .feedback.good{color:var(--correct)} .feedback.bad{color:var(--wrong)}
    details.help{margin-top:10px;background:#f3f4f6;border-radius:12px;padding:10px 12px}
    .summary{text-align:center;padding:10px 0 4px;font-size:1.15rem;font-weight:700}
    .review{display:grid;grid-template-columns:1fr;gap:10px;margin-top:10px}
    .review-item{background:#fff;border:2px solid #e5e7eb;border-left-width:8px;border-radius:12px;padding:10px 12px}
    .review-item.ok{border-left-color:var(--correct)} .review-item.ng{border-left-color:var(--wrong)}
    .tiny{color:var(--muted);font-size:.9rem}
    @media (min-width:720px){.question{grid-template-columns:128px 1fr;align-items:center}.passage{grid-column:1 / -1}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="emoji" aria-hidden="true">ğŸ“š</div>
      <div>
        <div class="title">Evelynâ€™s Reading Adventure</div>
        <div class="subtitle">Kinder MAP-style practice â€¢ Click to hear, choose an answer, then press â€œNextâ€</div>
      </div>
    </header>

    <div class="card" role="region" aria-live="polite">
      <div class="progress" aria-label="Progress"><div class="progress__bar" id="bar"></div></div>

      <div class="settings">
        <label>Voice style:
          <select id="voiceStyle">
            <option value="normal">Normal</option>
            <option value="friendly">Friendly Kids</option>
            <option value="calm">Calm Slow</option>
          </select>
        </label>
        <label>English voice:
          <select id="voicePick"><option>Auto</option></select>
        </label>
        <button class="btn ghost" id="readBtn" aria-label="Read this question aloud">ğŸ”Š Read</button>
        <div class="score" id="score">Score: 0</div>
      </div>

      <div class="question" id="question-area"></div>

      <div class="controls">
        <button class="btn light" id="nextBtn" disabled>Next â–¶</button>
      </div>
      <div class="feedback" id="feedback" aria-live="polite"></div>

      <details class="help">
        <summary>ë¶€ëª¨ë‹˜ ë„ì›€ë§ (Korean help)</summary>
        <ul class="tiny">
          <li>ì§€ë¬¸/ì§ˆë¬¸/ë³´ê¸°ë¥¼ <b>íƒ­</b>í•˜ë©´ í•´ë‹¹ ë¬¸ì¥ë§Œ ìì—°ìŠ¤ëŸ½ê²Œ ì½ì–´ì¤ë‹ˆë‹¤.</li>
          <li>Voice styleì—ì„œ <b>Friendly Kids</b>ë¥¼ ì„ íƒí•˜ë©´ í†¤ì´ ë” ë°ê³  ë¶€ë“œëŸ½ìŠµë‹ˆë‹¤.</li>
          <li>ì •ë‹µì€ ì´ˆë¡, ì˜¤ë‹µì€ ë¹¨ê°•ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</li>
        </ul>
      </details>
    </div>

    <div id="end" class="card" style="margin-top:14px; display:none;">
      <div class="summary" id="summaryText"></div>
      <div class="review" id="reviewList"></div>
      <div style="display:flex; gap:10px; justify-content:center; margin-top:10px;">
        <button class="btn" id="restartBtn">ğŸ” Play Again</button>
        <button class="btn ghost" id="readSummaryBtn">ğŸ”Š Read Summary</button>
      </div>
      <p class="tiny" style="text-align:center; margin-top:8px;">Great job, Evelyn! ğŸŒŸ</p>
    </div>
  </div>

  <script>
    // --- tiny chime for correct answers ---
    let audioCtx;
    function ding(){
      try{
        audioCtx = audioCtx || new (window.AudioContext||window.webkitAudioContext)();
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type='sine'; o.frequency.value=880;
        g.gain.value=0.0001;
        o.connect(g); g.connect(audioCtx.destination);
        o.start();
        g.gain.exponentialRampToValueAtTime(0.2, audioCtx.currentTime+0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+0.25);
        o.stop(audioCtx.currentTime+0.26);
      }catch(e){}
    }

    // --- shuffle helper ---
    function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]}return arr}

    // --- Questions (20) ---
    const QUESTIONS = [
      // 1-10 ê¸°ì¡´ ìœ í˜•
      {id:1,emoji:"ğŸ±",passage:"",question:"Which word matches the picture?",options:[{text:"dog",correct:false},{text:"cat",correct:true},{text:"fish",correct:false},{text:"bird",correct:false}],korean:{passage:"",question:"ê·¸ë¦¼ê³¼ ë§ëŠ” ë‹¨ì–´ëŠ” ë¬´ì—‡ì¼ê¹Œìš”? (ê³ ì–‘ì´)"}},
      {id:2,emoji:"ğŸ",passage:"",question:"Which word matches the picture?",options:[{text:"apple",correct:true},{text:"banana",correct:false},{text:"grape",correct:false},{text:"orange",correct:false}],korean:{passage:"",question:"ê·¸ë¦¼ê³¼ ë§ëŠ” ë‹¨ì–´ëŠ” ë¬´ì—‡ì¼ê¹Œìš”? (ì‚¬ê³¼)"}},
      {id:3,emoji:"âš½ï¸",passage:"Tim has a red ball. He plays with the ball.",question:"What does Tim have?",options:[{text:"a hat",correct:false},{text:"a ball",correct:true},{text:"a book",correct:false},{text:"a car",correct:false}],korean:{passage:"íŒ€ì—ê²Œ ë¹¨ê°„ ê³µì´ ìˆì–´ìš”. íŒ€ì€ ê·¸ ê³µìœ¼ë¡œ ë†‰ë‹ˆë‹¤.",question:"íŒ€ì€ ë¬´ì—‡ì„ ê°€ì§€ê³  ìˆë‚˜ìš”?"}},
      {id:4,emoji:"ğŸ¥£",passage:"Anna eats breakfast. Then she goes to school.",question:"What does Anna do first?",options:[{text:"Go to school",correct:false},{text:"Eat breakfast",correct:true},{text:"Sleep",correct:false},{text:"Read a book",correct:false}],korean:{passage:"ì•ˆë‚˜ëŠ” ì•„ì¹¨ì„ ë¨¹ê³ , ê·¸ ë‹¤ìŒ í•™êµì— ê°‘ë‹ˆë‹¤.",question:"ì•ˆë‚˜ê°€ ë¨¼ì € í•œ ì¼ì€ ë¬´ì—‡ì¸ê°€ìš”?"}},
      {id:5,emoji:"ğŸ§¥",passage:"Sam wears a coat. It is very cold outside.",question:"How is the weather?",options:[{text:"hot",correct:false},{text:"cold",correct:true},{text:"rainy",correct:false},{text:"windy",correct:false}],korean:{passage:"ìƒ˜ì€ ì½”íŠ¸ë¥¼ ì…ì—ˆì–´ìš”. ë°–ì€ ì•„ì£¼ ì¶”ì›Œìš”.",question:"ë‚ ì”¨ëŠ” ì–´ë–¤ê°€ìš”?"}},
      {id:6,emoji:"ğŸ‚",passage:"Mom and Dad bake a cake. They put candles on it. They sing a song.",question:"What is this story mostly about?",options:[{text:"A birthday party",correct:true},{text:"A school bus",correct:false},{text:"A zoo trip",correct:false},{text:"A beach day",correct:false}],korean:{passage:"ì—„ë§ˆ ì•„ë¹ ê°€ ì¼€ì´í¬ë¥¼ ë§Œë“¤ê³ , ì´›ë¶ˆì„ ê½‚ê³ , ë…¸ë˜ë¥¼ ë¶ˆëŸ¬ìš”.",question:"ì´ ì´ì•¼ê¸°ëŠ” ì£¼ë¡œ ë¬´ì—‡ì— ê´€í•œ ê±¸ê¹Œìš”?"}},
      {id:7,emoji:"ğŸµ",passage:"",question:"Which word rhymes with â€œcatâ€?",options:[{text:"hat",correct:true},{text:"dog",correct:false},{text:"sun",correct:false},{text:"fish",correct:false}],korean:{passage:"",question:"ë‹¤ìŒ ì¤‘ 'cat'ê³¼ ìš´ì´ ë§ëŠ” ë‹¨ì–´ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?"}},
      {id:8,emoji:"ğŸ˜¢",passage:"Ben lost his toy. He cries.",question:"How does Ben feel?",options:[{text:"happy",correct:false},{text:"sad",correct:true},{text:"hungry",correct:false},{text:"sleepy",correct:false}],korean:{passage:"ë²¤ì€ ì¥ë‚œê°ì„ ìƒì–´ë²„ë ¸ì–´ìš”. ê·¸ëŠ” ìš¸ê³  ìˆì–´ìš”.",question:"ë²¤ì˜ ê¸°ë¶„ì€ ì–´ë–¤ê°€ìš”?"}},
      {id:9,emoji:"ğŸŒ‚",passage:"Lisa takes an umbrella. The sky is gray.",question:"What will probably happen?",options:[{text:"It will snow",correct:false},{text:"It will rain",correct:true},{text:"It will be sunny",correct:false},{text:"It will be windy",correct:false}],korean:{passage:"ë¦¬ì‚¬ëŠ” ìš°ì‚°ì„ ê°€ì ¸ê°‘ë‹ˆë‹¤. í•˜ëŠ˜ì€ íšŒìƒ‰ì´ì—ìš”.",question:"ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚  ê°€ëŠ¥ì„±ì´ í´ê¹Œìš”?"}},
      {id:10,emoji:"ğŸš—",passage:"",question:"Which word matches the picture?",options:[{text:"car",correct:true},{text:"bus",correct:false},{text:"train",correct:false},{text:"bike",correct:false}],korean:{passage:"",question:"ê·¸ë¦¼ê³¼ ë§ëŠ” ë‹¨ì–´ëŠ” ë¬´ì—‡ì¼ê¹Œìš”? (ìë™ì°¨)"}},

      // 11-20 ì¶”ê°€ (ì‹œë ¥ ë‹¨ì–´/ì „ì¹˜ì‚¬/ì´ˆì„±/ì •ë³´ê¸€ ë“±)
      {id:11,emoji:"ğŸ‘€",passage:"Look at the dog under the table.",question:"Where is the dog?",options:[{text:"under the table",correct:true},{text:"on the table",correct:false},{text:"in the box",correct:false},{text:"behind the chair",correct:false}],korean:{passage:"ê°œê°€ í…Œì´ë¸” ì•„ë˜ ìˆì–´ìš”.",question:"ê°œëŠ” ì–´ë””ì— ìˆë‚˜ìš”?"}},
      {id:12,emoji:"ğŸ§º",passage:"Pam puts apples in the basket.",question:"What does Pam put in?",options:[{text:"in the basket",correct:true},{text:"on the shelf",correct:false},{text:"under the bed",correct:false},{text:"behind the door",correct:false}],korean:{passage:"íŒ¸ì€ ë°”êµ¬ë‹ˆì— ì‚¬ê³¼ë¥¼ ë„£ì–´ìš”.",question:"íŒ¸ì€ ì–´ë””ì— ë„£ë‚˜ìš”?"}},
      {id:13,emoji:"ğŸ¦‹",passage:"A butterfly has wings. It can fly.",question:"What can the butterfly do?",options:[{text:"swim",correct:false},{text:"fly",correct:true},{text:"drive",correct:false},{text:"read",correct:false}],korean:{passage:"ë‚˜ë¹„ëŠ” ë‚ ê°œê°€ ìˆì–´ìš”. ë‚  ìˆ˜ ìˆì–´ìš”.",question:"ë‚˜ë¹„ê°€ í•  ìˆ˜ ìˆëŠ” ê²ƒì€?"}},
      {id:14,emoji:"ğŸ“—",passage:"Kim reads a book to her friend.",question:"Who does Kim read to?",options:[{text:"her friend",correct:true},{text:"her dog",correct:false},{text:"her teacher",correct:false},{text:"her mom",correct:false}],korean:{passage:"í‚´ì€ ì¹œêµ¬ì—ê²Œ ì±…ì„ ì½ì–´ì¤˜ìš”.",question:"í‚´ì€ ëˆ„êµ¬ì—ê²Œ ì½ì–´ì£¼ë‚˜ìš”?"}},
      {id:15,emoji:"ğŸŒ",passage:"The sun is bright. We wear hats.",question:"Why do we wear hats?",options:[{text:"Because it is bright",correct:true},{text:"Because it is rainy",correct:false},{text:"Because it is snowy",correct:false},{text:"Because it is windy",correct:false}],korean:{passage:"í•´ê°€ ë°ì•„ìš”. ìš°ë¦¬ëŠ” ëª¨ìë¥¼ ì¨ìš”.",question:"ì™œ ëª¨ìë¥¼ ì“°ë‚˜ìš”?"}},
      {id:16,emoji:"ğŸ§Š",passage:"Which word starts with the same sound as 'cat'?",question:"Pick the word.",options:[{text:"cup",correct:true},{text:"sun",correct:false},{text:"dog",correct:false},{text:"fish",correct:false}],korean:{passage:"ì–´ë–¤ ë‹¨ì–´ê°€ 'cat'ê³¼ ê°™ì€ ì†Œë¦¬ë¡œ ì‹œì‘í• ê¹Œìš”?",question:"ë‹¨ì–´ë¥¼ ê³ ë¥´ì„¸ìš”."}},
      {id:17,emoji:"ğŸª",passage:"Max has 2 cookies. He gives one to Ana.",question:"How many cookies does Max have now?",options:[{text:"1",correct:true},{text:"2",correct:false},{text:"3",correct:false},{text:"0",correct:false}],korean:{passage:"ë§¥ìŠ¤ëŠ” ì¿ í‚¤ 2ê°œê°€ ìˆì–´ìš”. í•˜ë‚˜ë¥¼ ì•„ë‚˜ì—ê²Œ ì¤˜ìš”.",question:"ì§€ê¸ˆ ë§¥ìŠ¤ëŠ” ëª‡ ê°œê°€ ë‚¨ì•˜ë‚˜ìš”?"}},
      {id:18,emoji:"ğŸ§¸",passage:"â€œI love my teddy,â€ says Mia.",question:"Who says this?",options:[{text:"Mia",correct:true},{text:"Tim",correct:false},{text:"Sam",correct:false},{text:"Ben",correct:false}],korean:{passage:"â€œí…Œë””ë² ì–´ê°€ ì¢‹ì•„ìš”.â€ ë¯¸ì•„ê°€ ë§í•´ìš”.",question:"ëˆ„ê°€ ë§í–ˆë‚˜ìš”?"}},
      {id:19,emoji:"ğŸª´",passage:"Plants need water and sun to grow.",question:"What do plants need?",options:[{text:"water and sun",correct:true},{text:"shoes",correct:false},{text:"toys",correct:false},{text:"books",correct:false}],korean:{passage:"ì‹ë¬¼ì€ ìë¼ë ¤ë©´ ë¬¼ê³¼ í–‡ë¹›ì´ í•„ìš”í•´ìš”.",question:"ì‹ë¬¼ì€ ë¬´ì—‡ì´ í•„ìš”í• ê¹Œìš”?"}},
      {id:20,emoji:"ğŸ’",passage:"Tom packs a bag. He puts in a pen, a book, and a snack.",question:"What is Tom doing?",options:[{text:"packing a bag",correct:true},{text:"flying a kite",correct:false},{text:"riding a bike",correct:false},{text:"washing hands",correct:false}],korean:{passage:"í†°ì€ ê°€ë°©ì„ ì±™ê²¨ìš”. íœ, ì±…, ê°„ì‹ì„ ë„£ì–´ìš”.",question:"í†°ì€ ë¬´ì—‡ì„ í•˜ë‚˜ìš”?"}}
    ];

    // --- state ---
    let order = [...Array(QUESTIONS.length).keys()];
    let index = 0, score = 0, answered = [], locked = false;

    // --- elements ---
    const bar = document.getElementById('bar');
    const qArea = document.getElementById('question-area');
    const nextBtn = document.getElementById('nextBtn');
    const readBtn = document.getElementById('readBtn');
    const scoreEl = document.getElementById('score');
    const feedbackEl = document.getElementById('feedback');
    const endCard = document.getElementById('end');
    const summaryText = document.getElementById('summaryText');
    const reviewList = document.getElementById('reviewList');
    const restartBtn = document.getElementById('restartBtn');
    const readSummaryBtn = document.getElementById('readSummaryBtn');
    const voiceStyleSel = document.getElementById('voiceStyle');
    const voicePickSel = document.getElementById('voicePick');

    // --- TTS helpers ---
    let VOICES = [];
    function loadVoices(){
      if(!('speechSynthesis' in window)) return;
      VOICES = window.speechSynthesis.getVoices();
      // populate picker
      const prev = voicePickSel.value;
      voicePickSel.innerHTML = '<option value="">Auto</option>';
      VOICES.filter(v=>/en(-|_)?(US|GB|AU|CA|IN)/i.test(v.lang))
            .forEach(v=>{
              const opt = document.createElement('option');
              opt.value = v.name;
              opt.textContent = `${v.name} (${v.lang})`;
              voicePickSel.appendChild(opt);
            });
      if ([...voicePickSel.options].some(o=>o.value===prev)) voicePickSel.value = prev;
    }
    if('speechSynthesis' in window){
      window.speechSynthesis.onvoiceschanged = loadVoices;
      loadVoices();
    }

    function getVoiceParams(){
      const style = voiceStyleSel.value;
      let rate=0.95, pitch=1.0;
      if(style==='friendly'){ rate=0.92; pitch=1.2; }
      if(style==='calm'){ rate=0.85; pitch=1.0; }
      return {rate, pitch};
    }

    function speak(text){
      try{
        if(!('speechSynthesis' in window)) return;
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        const {rate, pitch} = getVoiceParams();
        u.rate = rate; u.pitch = pitch; u.volume = 1.0;
        // prefer selected voice
        const pick = VOICES.find(v=>v.name===voicePickSel.value);
        if (pick) u.voice = pick;
        else {
          // fallback English voice
          const en = VOICES.find(v=>/en(-|_)?(US|GB|AU|CA|IN)/i.test(v.lang));
          if (en) u.voice = en;
        }
        window.speechSynthesis.speak(u);
      }catch(e){}
    }

    // natural pacing: break into short chunks with tiny pauses
    function speakSmooth(parts){
      try{
        if(!('speechSynthesis' in window)) return;
        window.speechSynthesis.cancel();
        const {rate, pitch} = getVoiceParams();
        const pick = VOICES.find(v=>v.name===voicePickSel.value) ||
                     VOICES.find(v=>/en(-|_)?(US|GB|AU|CA|IN)/i.test(v.lang));
        let delay = 0;
        parts.forEach((t,i)=>{
          const u = new SpeechSynthesisUtterance(t);
          if(pick) u.voice = pick;
          u.rate = rate; u.pitch = pitch; u.volume = 1.0;
          setTimeout(()=>window.speechSynthesis.speak(u), delay);
          // add small pauses; longer pause after last passage segment
          delay += Math.max(300, Math.min(900, 200 + t.length*12));
        });
      }catch(e){}
    }

    // --- render ---
    function init(){
      order = shuffle(order);
      QUESTIONS.forEach(q=>shuffle(q.options));
      index=0; score=0; answered=[]; locked=false;
      endCard.style.display='none';
      nextBtn.disabled=true; scoreEl.textContent=`Score: ${score}`;
      feedbackEl.textContent=''; render();
    }

    function render(){
      const q = QUESTIONS[order[index]];
      const progress = (index/QUESTIONS.length)*100;
      bar.style.width = `${progress}%`;
      qArea.innerHTML = '';

      const emoji = document.createElement('div');
      emoji.className = 'emoji';
      emoji.textContent = q.emoji || 'ğŸ“–';
      emoji.setAttribute('aria-hidden','true');
      emoji.addEventListener('click', ()=> speak('Look and choose the answer.'));

      const passage = document.createElement('div');
      passage.className = 'passage';
      passage.textContent = q.passage || "Look at the picture and choose the matching word.";
      passage.addEventListener('click', ()=>{
        if(q.passage) speakSmooth([q.passage]);
        else speak('Look at the picture and choose the matching word.');
      });

      const qtext = document.createElement('div');
      qtext.className = 'qtext';
      qtext.textContent = q.question;
      qtext.addEventListener('click', ()=> speakSmooth([q.question]));

      const leftCol = document.createElement('div'); leftCol.appendChild(emoji);
      const rightCol = document.createElement('div'); rightCol.appendChild(passage); rightCol.appendChild(qtext);
      qArea.appendChild(leftCol); qArea.appendChild(rightCol);

      const choices = document.createElement('div'); choices.className='choices';
      q.options.forEach((opt,i)=>{
        const btn = document.createElement('button');
        btn.className = 'choice'; btn.textContent = opt.text;
        btn.setAttribute('data-correct', opt.correct ? '1':'0');
        btn.addEventListener('click', ()=> onChoose(btn, opt.correct, q));
        btn.addEventListener('mouseenter', ()=>{}); // noop
        btn.addEventListener('click', (e)=>{}); // already handled
        btn.addEventListener('dblclick', (e)=> e.preventDefault());
        // tap to hear this option
        btn.addEventListener('pointerdown', (ev)=>{
          if(!locked) speakSmooth([opt.text]);
        });
        choices.appendChild(btn);
      });

      // Korean help
      const help = document.createElement('details');
      help.className='help';
      const sm = document.createElement('summary'); sm.textContent = 'í•œêµ­ì–´ íŒíŠ¸ ë³´ê¸° (Show Korean help)';
      const kp = document.createElement('p');
      kp.innerHTML = `<strong>ë¬¸ì¥:</strong> ${q.korean.passage||'(ê·¸ë¦¼ ë³´ê³  ë§ì¶”ê¸°)'}<br><strong>ì§ˆë¬¸:</strong> ${q.korean.question}`;
      help.appendChild(sm); help.appendChild(kp);

      qArea.appendChild(choices);
      qArea.appendChild(help);

      nextBtn.disabled = true; feedbackEl.textContent = ''; locked=false;
    }

    function onChoose(btn,isCorrect,q){
      if(locked) return; locked=true;
      const all = qArea.querySelectorAll('button.choice'); all.forEach(b=>b.disabled=true);

      if(isCorrect){
        btn.classList.add('correct');
        feedbackEl.textContent = 'Great job! âœ…';
        feedbackEl.className = 'feedback good';
        score += 1; scoreEl.textContent = `Score: ${score}`;
        ding();
        speakSmooth(['Great job!']);
      }else{
        btn.classList.add('wrong');
        feedbackEl.textContent = 'Nice try! Letâ€™s check the right one. âŒ';
        feedbackEl.className = 'feedback bad';
        all.forEach(b=>{ if(b.getAttribute('data-correct')==='1'){ b.classList.add('correct'); } });
        speakSmooth(['Nice try.', 'Letâ€™s check the right one.']);
      }

      answered.push({
        id:q.id,question:q.question,chosen:btn.textContent,correct:isCorrect,
        correctAnswer:q.options.find(o=>o.correct).text,passage:q.passage,emoji:q.emoji
      });

      nextBtn.disabled = false;
    }

    function next(){
      if(index < QUESTIONS.length - 1){ index += 1; render(); }
      else { finish(); }
    }

    function finish(){
      bar.style.width='100%';
      endCard.style.display='block';
      const total = QUESTIONS.length;
      summaryText.textContent = `You got ${score} out of ${total}! ğŸ‰`;
      reviewList.innerHTML = '';
      answered.forEach((a,i)=>{
        const item = document.createElement('div');
        item.className = 'review-item ' + (a.correct ? 'ok' : 'ng');
        item.innerHTML = `
          <div><span class="emoji">${a.emoji||'ğŸ“–'}</span> <strong>Q${i+1}.</strong> ${a.question}</div>
          ${a.passage?`<div class="tiny" style="margin-top:4px;"><em>â€œ${a.passage}â€</em></div>`:''}
          <div style="margin-top:6px;">Your answer: <strong>${a.chosen}</strong> ${a.correct ? 'âœ…' : 'âŒ'}</div>
          ${!a.correct?`<div class="tiny">Correct: <strong>${a.correctAnswer}</strong></div>`:''}
        `;
        reviewList.appendChild(item);
      });
      speak(`Great job! You got ${score} out of ${total} correct.`);
    }

    // --- wire up ---
    nextBtn.addEventListener('click', next);
    readBtn.addEventListener('click', ()=>{
      const q = QUESTIONS[order[index]];
      const parts = [];
      if(q.passage) parts.push(q.passage);
      parts.push(q.question);
      parts.push('Choices: ' + q.options.map((o,i)=>`${String.fromCharCode(65+i)}. ${o.text}`).join(', '));
      speakSmooth(parts);
    });
    restartBtn && restartBtn.addEventListener('click', init);
    readSummaryBtn && readSummaryBtn.addEventListener('click', ()=> speak(summaryText.textContent));
    voiceStyleSel.addEventListener('change', ()=>{}); // style applied on next speak
    voicePickSel.addEventListener('change', ()=>{});  // voice applied on next speak

    init();
  </script>
</body>
</html>
