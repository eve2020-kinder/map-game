<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Evelyn’s Reading Adventure — Kinder MAP Practice</title>
  <style>
    :root { --bg:#f6f7fb; --card:#fff; --text:#1f2937; --muted:#6b7280; --primary:#2563eb; --correct:#16a34a; --wrong:#dc2626; --shadow:0 10px 24px rgba(0,0,0,.08); --radius:18px; }
    *{box-sizing:border-box} body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;line-height:1.5}
    .wrap{max-width:960px;margin:32px auto;padding:16px}
    header{display:flex;align-items:center;gap:16px;margin-bottom:16px}
    .title{font-size:1.6rem;font-weight:800;letter-spacing:.2px}
    .subtitle{color:var(--muted);font-size:.95rem}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px}
    .progress{width:100%;height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden;margin:8px 0 16px}
    .progress__bar{height:10px;width:0;background:var(--primary);transition:width .3s ease}
    .settings{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:8px 0 14px}
    .settings label{font-size:.95rem;color:var(--muted)}
    select, .tog{appearance:none;border:2px solid #e5e7eb;border-radius:10px;padding:8px 10px;background:#fff}
    .question{display:grid;grid-template-columns:1fr;gap:12px;margin:6px 0 12px}
    .emoji{font-size:64px;line-height:1;display:inline-block;filter:drop-shadow(0 4px 10px rgba(0,0,0,.1));cursor:pointer}
    .passage{font-size:1.15rem;background:#f9fafb;border-radius:12px;padding:14px;cursor:pointer}
    .qtext{font-size:1.25rem;font-weight:700;margin-top:4px;cursor:pointer}
    .choices{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;margin-top:8px}
    button.choice{border:2px solid #e5e7eb;background:#fff;padding:14px 16px;border-radius:12px;font-size:1.05rem;text-align:left;cursor:pointer;transition:transform .05s,border-color .2s,box-shadow .2s,background .2s}
    button.choice:hover{transform:translateY(-1px)} button.choice:focus{outline:3px solid rgba(37,99,235,.35)}
    button.choice.correct{background:rgba(22,163,74,.08);border-color:rgba(22,163,74,.6)}
    button.choice.wrong{background:rgba(220,38,38,.08);border-color:rgba(220,38,38,.6)}
    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px}
    .btn{border:0;padding:12px 16px;border-radius:12px;font-weight:700;cursor:pointer;box-shadow:var(--shadow);background:var(--primary);color:#fff;transition:transform .06s,opacity .2s,background .2s}
    .btn:disabled{opacity:.5;cursor:not-allowed} .btn.light{background:#111827} .btn.ghost{background:#fff;color:var(--text);border:2px solid #e5e7eb;box-shadow:none}
    .score{margin-left:auto;font-weight:800}
    .feedback{min-height:28px;margin-top:6px;font-weight:600} .feedback.good{color:var(--correct)} .feedback.bad{color:var(--wrong)}
    details.help{margin-top:10px;background:#f3f4f6;border-radius:12px;padding:10px 12px}
    .summary{text-align:center;padding:10px 0 4px;font-size:1.15rem;font-weight:700}
    .review{display:grid;grid-template-columns:1fr;gap:10px;margin-top:10px}
    .review-item{background:#fff;border:2px solid #e5e7eb;border-left-width:8px;border-radius:12px;padding:10px 12px}
    .review-item.ok{border-left-color:var(--correct)} .review-item.ng{border-left-color:var(--wrong)}
    .tiny{color:var(--muted);font-size:.9rem}
    @media (min-width:720px){.question{grid-template-columns:128px 1fr;align-items:center}.passage{grid-column:1 / -1}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="emoji" aria-hidden="true">📚</div>
      <div>
        <div class="title">Evelyn’s Reading Adventure</div>
        <div class="subtitle">Kinder MAP-style practice • Click to hear, choose an answer, then press “Next”</div>
      </div>
    </header>

    <div class="card" role="region" aria-live="polite">
      <div class="progress" aria-label="Progress"><div class="progress__bar" id="bar"></div></div>

      <div class="settings">
        <label>Voice style:
          <select id="voiceStyle">
            <option value="normal">Normal</option>
            <option value="friendly">Friendly Kids</option>
            <option value="calm">Calm Slow</option>
          </select>
        </label>
        <label>English voice:
          <select id="voicePick"><option>Auto</option></select>
        </label>
        <button class="btn ghost" id="readBtn" aria-label="Read this question aloud">🔊 Read</button>
        <div class="score" id="score">Score: 0</div>
      </div>

      <div class="question" id="question-area"></div>

      <div class="controls">
        <button class="btn light" id="nextBtn" disabled>Next ▶</button>
      </div>
      <div class="feedback" id="feedback" aria-live="polite"></div>

      <details class="help">
        <summary>부모님 도움말 (Korean help)</summary>
        <ul class="tiny">
          <li>지문/질문/보기를 <b>탭</b>하면 해당 문장만 자연스럽게 읽어줍니다.</li>
          <li>Voice style에서 <b>Friendly Kids</b>를 선택하면 톤이 더 밝고 부드럽습니다.</li>
          <li>정답은 초록, 오답은 빨강으로 표시됩니다.</li>
        </ul>
      </details>
    </div>

    <div id="end" class="card" style="margin-top:14px; display:none;">
      <div class="summary" id="summaryText"></div>
      <div class="review" id="reviewList"></div>
      <div style="display:flex; gap:10px; justify-content:center; margin-top:10px;">
        <button class="btn" id="restartBtn">🔁 Play Again</button>
        <button class="btn ghost" id="readSummaryBtn">🔊 Read Summary</button>
      </div>
      <p class="tiny" style="text-align:center; margin-top:8px;">Great job, Evelyn! 🌟</p>
    </div>
  </div>

  <script>
    // --- tiny chime for correct answers ---
    let audioCtx;
    function ding(){
      try{
        audioCtx = audioCtx || new (window.AudioContext||window.webkitAudioContext)();
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type='sine'; o.frequency.value=880;
        g.gain.value=0.0001;
        o.connect(g); g.connect(audioCtx.destination);
        o.start();
        g.gain.exponentialRampToValueAtTime(0.2, audioCtx.currentTime+0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+0.25);
        o.stop(audioCtx.currentTime+0.26);
      }catch(e){}
    }

    // --- shuffle helper ---
    function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]}return arr}

    // --- Questions (20) ---
    const QUESTIONS = [
      // 1-10 기존 유형
      {id:1,emoji:"🐱",passage:"",question:"Which word matches the picture?",options:[{text:"dog",correct:false},{text:"cat",correct:true},{text:"fish",correct:false},{text:"bird",correct:false}],korean:{passage:"",question:"그림과 맞는 단어는 무엇일까요? (고양이)"}},
      {id:2,emoji:"🍎",passage:"",question:"Which word matches the picture?",options:[{text:"apple",correct:true},{text:"banana",correct:false},{text:"grape",correct:false},{text:"orange",correct:false}],korean:{passage:"",question:"그림과 맞는 단어는 무엇일까요? (사과)"}},
      {id:3,emoji:"⚽️",passage:"Tim has a red ball. He plays with the ball.",question:"What does Tim have?",options:[{text:"a hat",correct:false},{text:"a ball",correct:true},{text:"a book",correct:false},{text:"a car",correct:false}],korean:{passage:"팀에게 빨간 공이 있어요. 팀은 그 공으로 놉니다.",question:"팀은 무엇을 가지고 있나요?"}},
      {id:4,emoji:"🥣",passage:"Anna eats breakfast. Then she goes to school.",question:"What does Anna do first?",options:[{text:"Go to school",correct:false},{text:"Eat breakfast",correct:true},{text:"Sleep",correct:false},{text:"Read a book",correct:false}],korean:{passage:"안나는 아침을 먹고, 그 다음 학교에 갑니다.",question:"안나가 먼저 한 일은 무엇인가요?"}},
      {id:5,emoji:"🧥",passage:"Sam wears a coat. It is very cold outside.",question:"How is the weather?",options:[{text:"hot",correct:false},{text:"cold",correct:true},{text:"rainy",correct:false},{text:"windy",correct:false}],korean:{passage:"샘은 코트를 입었어요. 밖은 아주 추워요.",question:"날씨는 어떤가요?"}},
      {id:6,emoji:"🎂",passage:"Mom and Dad bake a cake. They put candles on it. They sing a song.",question:"What is this story mostly about?",options:[{text:"A birthday party",correct:true},{text:"A school bus",correct:false},{text:"A zoo trip",correct:false},{text:"A beach day",correct:false}],korean:{passage:"엄마 아빠가 케이크를 만들고, 촛불을 꽂고, 노래를 불러요.",question:"이 이야기는 주로 무엇에 관한 걸까요?"}},
      {id:7,emoji:"🎵",passage:"",question:"Which word rhymes with “cat”?",options:[{text:"hat",correct:true},{text:"dog",correct:false},{text:"sun",correct:false},{text:"fish",correct:false}],korean:{passage:"",question:"다음 중 'cat'과 운이 맞는 단어는 무엇일까요?"}},
      {id:8,emoji:"😢",passage:"Ben lost his toy. He cries.",question:"How does Ben feel?",options:[{text:"happy",correct:false},{text:"sad",correct:true},{text:"hungry",correct:false},{text:"sleepy",correct:false}],korean:{passage:"벤은 장난감을 잃어버렸어요. 그는 울고 있어요.",question:"벤의 기분은 어떤가요?"}},
      {id:9,emoji:"🌂",passage:"Lisa takes an umbrella. The sky is gray.",question:"What will probably happen?",options:[{text:"It will snow",correct:false},{text:"It will rain",correct:true},{text:"It will be sunny",correct:false},{text:"It will be windy",correct:false}],korean:{passage:"리사는 우산을 가져갑니다. 하늘은 회색이에요.",question:"무슨 일이 일어날 가능성이 클까요?"}},
      {id:10,emoji:"🚗",passage:"",question:"Which word matches the picture?",options:[{text:"car",correct:true},{text:"bus",correct:false},{text:"train",correct:false},{text:"bike",correct:false}],korean:{passage:"",question:"그림과 맞는 단어는 무엇일까요? (자동차)"}},

      // 11-20 추가 (시력 단어/전치사/초성/정보글 등)
      {id:11,emoji:"👀",passage:"Look at the dog under the table.",question:"Where is the dog?",options:[{text:"under the table",correct:true},{text:"on the table",correct:false},{text:"in the box",correct:false},{text:"behind the chair",correct:false}],korean:{passage:"개가 테이블 아래 있어요.",question:"개는 어디에 있나요?"}},
      {id:12,emoji:"🧺",passage:"Pam puts apples in the basket.",question:"What does Pam put in?",options:[{text:"in the basket",correct:true},{text:"on the shelf",correct:false},{text:"under the bed",correct:false},{text:"behind the door",correct:false}],korean:{passage:"팸은 바구니에 사과를 넣어요.",question:"팸은 어디에 넣나요?"}},
      {id:13,emoji:"🦋",passage:"A butterfly has wings. It can fly.",question:"What can the butterfly do?",options:[{text:"swim",correct:false},{text:"fly",correct:true},{text:"drive",correct:false},{text:"read",correct:false}],korean:{passage:"나비는 날개가 있어요. 날 수 있어요.",question:"나비가 할 수 있는 것은?"}},
      {id:14,emoji:"📗",passage:"Kim reads a book to her friend.",question:"Who does Kim read to?",options:[{text:"her friend",correct:true},{text:"her dog",correct:false},{text:"her teacher",correct:false},{text:"her mom",correct:false}],korean:{passage:"킴은 친구에게 책을 읽어줘요.",question:"킴은 누구에게 읽어주나요?"}},
      {id:15,emoji:"🌞",passage:"The sun is bright. We wear hats.",question:"Why do we wear hats?",options:[{text:"Because it is bright",correct:true},{text:"Because it is rainy",correct:false},{text:"Because it is snowy",correct:false},{text:"Because it is windy",correct:false}],korean:{passage:"해가 밝아요. 우리는 모자를 써요.",question:"왜 모자를 쓰나요?"}},
      {id:16,emoji:"🧊",passage:"Which word starts with the same sound as 'cat'?",question:"Pick the word.",options:[{text:"cup",correct:true},{text:"sun",correct:false},{text:"dog",correct:false},{text:"fish",correct:false}],korean:{passage:"어떤 단어가 'cat'과 같은 소리로 시작할까요?",question:"단어를 고르세요."}},
      {id:17,emoji:"🍪",passage:"Max has 2 cookies. He gives one to Ana.",question:"How many cookies does Max have now?",options:[{text:"1",correct:true},{text:"2",correct:false},{text:"3",correct:false},{text:"0",correct:false}],korean:{passage:"맥스는 쿠키 2개가 있어요. 하나를 아나에게 줘요.",question:"지금 맥스는 몇 개가 남았나요?"}},
      {id:18,emoji:"🧸",passage:"“I love my teddy,” says Mia.",question:"Who says this?",options:[{text:"Mia",correct:true},{text:"Tim",correct:false},{text:"Sam",correct:false},{text:"Ben",correct:false}],korean:{passage:"“테디베어가 좋아요.” 미아가 말해요.",question:"누가 말했나요?"}},
      {id:19,emoji:"🪴",passage:"Plants need water and sun to grow.",question:"What do plants need?",options:[{text:"water and sun",correct:true},{text:"shoes",correct:false},{text:"toys",correct:false},{text:"books",correct:false}],korean:{passage:"식물은 자라려면 물과 햇빛이 필요해요.",question:"식물은 무엇이 필요할까요?"}},
      {id:20,emoji:"🎒",passage:"Tom packs a bag. He puts in a pen, a book, and a snack.",question:"What is Tom doing?",options:[{text:"packing a bag",correct:true},{text:"flying a kite",correct:false},{text:"riding a bike",correct:false},{text:"washing hands",correct:false}],korean:{passage:"톰은 가방을 챙겨요. 펜, 책, 간식을 넣어요.",question:"톰은 무엇을 하나요?"}}
    ];

    // --- state ---
    let order = [...Array(QUESTIONS.length).keys()];
    let index = 0, score = 0, answered = [], locked = false;

    // --- elements ---
    const bar = document.getElementById('bar');
    const qArea = document.getElementById('question-area');
    const nextBtn = document.getElementById('nextBtn');
    const readBtn = document.getElementById('readBtn');
    const scoreEl = document.getElementById('score');
    const feedbackEl = document.getElementById('feedback');
    const endCard = document.getElementById('end');
    const summaryText = document.getElementById('summaryText');
    const reviewList = document.getElementById('reviewList');
    const restartBtn = document.getElementById('restartBtn');
    const readSummaryBtn = document.getElementById('readSummaryBtn');
    const voiceStyleSel = document.getElementById('voiceStyle');
    const voicePickSel = document.getElementById('voicePick');

    // --- TTS helpers ---
    let VOICES = [];
    function loadVoices(){
      if(!('speechSynthesis' in window)) return;
      VOICES = window.speechSynthesis.getVoices();
      // populate picker
      const prev = voicePickSel.value;
      voicePickSel.innerHTML = '<option value="">Auto</option>';
      VOICES.filter(v=>/en(-|_)?(US|GB|AU|CA|IN)/i.test(v.lang))
            .forEach(v=>{
              const opt = document.createElement('option');
              opt.value = v.name;
              opt.textContent = `${v.name} (${v.lang})`;
              voicePickSel.appendChild(opt);
            });
      if ([...voicePickSel.options].some(o=>o.value===prev)) voicePickSel.value = prev;
    }
    if('speechSynthesis' in window){
      window.speechSynthesis.onvoiceschanged = loadVoices;
      loadVoices();
    }

    function getVoiceParams(){
      const style = voiceStyleSel.value;
      let rate=0.95, pitch=1.0;
      if(style==='friendly'){ rate=0.92; pitch=1.2; }
      if(style==='calm'){ rate=0.85; pitch=1.0; }
      return {rate, pitch};
    }

    function speak(text){
      try{
        if(!('speechSynthesis' in window)) return;
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        const {rate, pitch} = getVoiceParams();
        u.rate = rate; u.pitch = pitch; u.volume = 1.0;
        // prefer selected voice
        const pick = VOICES.find(v=>v.name===voicePickSel.value);
        if (pick) u.voice = pick;
        else {
          // fallback English voice
          const en = VOICES.find(v=>/en(-|_)?(US|GB|AU|CA|IN)/i.test(v.lang));
          if (en) u.voice = en;
        }
        window.speechSynthesis.speak(u);
      }catch(e){}
    }

    // natural pacing: break into short chunks with tiny pauses
    function speakSmooth(parts){
      try{
        if(!('speechSynthesis' in window)) return;
        window.speechSynthesis.cancel();
        const {rate, pitch} = getVoiceParams();
        const pick = VOICES.find(v=>v.name===voicePickSel.value) ||
                     VOICES.find(v=>/en(-|_)?(US|GB|AU|CA|IN)/i.test(v.lang));
        let delay = 0;
        parts.forEach((t,i)=>{
          const u = new SpeechSynthesisUtterance(t);
          if(pick) u.voice = pick;
          u.rate = rate; u.pitch = pitch; u.volume = 1.0;
          setTimeout(()=>window.speechSynthesis.speak(u), delay);
          // add small pauses; longer pause after last passage segment
          delay += Math.max(300, Math.min(900, 200 + t.length*12));
        });
      }catch(e){}
    }

    // --- render ---
    function init(){
      order = shuffle(order);
      QUESTIONS.forEach(q=>shuffle(q.options));
      index=0; score=0; answered=[]; locked=false;
      endCard.style.display='none';
      nextBtn.disabled=true; scoreEl.textContent=`Score: ${score}`;
      feedbackEl.textContent=''; render();
    }

    function render(){
      const q = QUESTIONS[order[index]];
      const progress = (index/QUESTIONS.length)*100;
      bar.style.width = `${progress}%`;
      qArea.innerHTML = '';

      const emoji = document.createElement('div');
      emoji.className = 'emoji';
      emoji.textContent = q.emoji || '📖';
      emoji.setAttribute('aria-hidden','true');
      emoji.addEventListener('click', ()=> speak('Look and choose the answer.'));

      const passage = document.createElement('div');
      passage.className = 'passage';
      passage.textContent = q.passage || "Look at the picture and choose the matching word.";
      passage.addEventListener('click', ()=>{
        if(q.passage) speakSmooth([q.passage]);
        else speak('Look at the picture and choose the matching word.');
      });

      const qtext = document.createElement('div');
      qtext.className = 'qtext';
      qtext.textContent = q.question;
      qtext.addEventListener('click', ()=> speakSmooth([q.question]));

      const leftCol = document.createElement('div'); leftCol.appendChild(emoji);
      const rightCol = document.createElement('div'); rightCol.appendChild(passage); rightCol.appendChild(qtext);
      qArea.appendChild(leftCol); qArea.appendChild(rightCol);

      const choices = document.createElement('div'); choices.className='choices';
      q.options.forEach((opt,i)=>{
        const btn = document.createElement('button');
        btn.className = 'choice'; btn.textContent = opt.text;
        btn.setAttribute('data-correct', opt.correct ? '1':'0');
        btn.addEventListener('click', ()=> onChoose(btn, opt.correct, q));
        btn.addEventListener('mouseenter', ()=>{}); // noop
        btn.addEventListener('click', (e)=>{}); // already handled
        btn.addEventListener('dblclick', (e)=> e.preventDefault());
        // tap to hear this option
        btn.addEventListener('pointerdown', (ev)=>{
          if(!locked) speakSmooth([opt.text]);
        });
        choices.appendChild(btn);
      });

      // Korean help
      const help = document.createElement('details');
      help.className='help';
      const sm = document.createElement('summary'); sm.textContent = '한국어 힌트 보기 (Show Korean help)';
      const kp = document.createElement('p');
      kp.innerHTML = `<strong>문장:</strong> ${q.korean.passage||'(그림 보고 맞추기)'}<br><strong>질문:</strong> ${q.korean.question}`;
      help.appendChild(sm); help.appendChild(kp);

      qArea.appendChild(choices);
      qArea.appendChild(help);

      nextBtn.disabled = true; feedbackEl.textContent = ''; locked=false;
    }

    function onChoose(btn,isCorrect,q){
      if(locked) return; locked=true;
      const all = qArea.querySelectorAll('button.choice'); all.forEach(b=>b.disabled=true);

      if(isCorrect){
        btn.classList.add('correct');
        feedbackEl.textContent = 'Great job! ✅';
        feedbackEl.className = 'feedback good';
        score += 1; scoreEl.textContent = `Score: ${score}`;
        ding();
        speakSmooth(['Great job!']);
      }else{
        btn.classList.add('wrong');
        feedbackEl.textContent = 'Nice try! Let’s check the right one. ❌';
        feedbackEl.className = 'feedback bad';
        all.forEach(b=>{ if(b.getAttribute('data-correct')==='1'){ b.classList.add('correct'); } });
        speakSmooth(['Nice try.', 'Let’s check the right one.']);
      }

      answered.push({
        id:q.id,question:q.question,chosen:btn.textContent,correct:isCorrect,
        correctAnswer:q.options.find(o=>o.correct).text,passage:q.passage,emoji:q.emoji
      });

      nextBtn.disabled = false;
    }

    function next(){
      if(index < QUESTIONS.length - 1){ index += 1; render(); }
      else { finish(); }
    }

    function finish(){
      bar.style.width='100%';
      endCard.style.display='block';
      const total = QUESTIONS.length;
      summaryText.textContent = `You got ${score} out of ${total}! 🎉`;
      reviewList.innerHTML = '';
      answered.forEach((a,i)=>{
        const item = document.createElement('div');
        item.className = 'review-item ' + (a.correct ? 'ok' : 'ng');
        item.innerHTML = `
          <div><span class="emoji">${a.emoji||'📖'}</span> <strong>Q${i+1}.</strong> ${a.question}</div>
          ${a.passage?`<div class="tiny" style="margin-top:4px;"><em>“${a.passage}”</em></div>`:''}
          <div style="margin-top:6px;">Your answer: <strong>${a.chosen}</strong> ${a.correct ? '✅' : '❌'}</div>
          ${!a.correct?`<div class="tiny">Correct: <strong>${a.correctAnswer}</strong></div>`:''}
        `;
        reviewList.appendChild(item);
      });
      speak(`Great job! You got ${score} out of ${total} correct.`);
    }

    // --- wire up ---
    nextBtn.addEventListener('click', next);
    readBtn.addEventListener('click', ()=>{
      const q = QUESTIONS[order[index]];
      const parts = [];
      if(q.passage) parts.push(q.passage);
      parts.push(q.question);
      parts.push('Choices: ' + q.options.map((o,i)=>`${String.fromCharCode(65+i)}. ${o.text}`).join(', '));
      speakSmooth(parts);
    });
    restartBtn && restartBtn.addEventListener('click', init);
    readSummaryBtn && readSummaryBtn.addEventListener('click', ()=> speak(summaryText.textContent));
    voiceStyleSel.addEventListener('change', ()=>{}); // style applied on next speak
    voicePickSel.addEventListener('change', ()=>{});  // voice applied on next speak

    init();
  </script>
</body>
</html>
